<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>AntiquaVision Pro</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>

/* ================= COLORS ================= */

:root{
 --gold:#d4af37;
 --blue:#4f9cff;
 --green:#3ad29f;
 --red:#ff6b6b;
 --violet:#9b7bff;
 --bg1:#06080f;
 --bg2:#0e1220;
 --card:#151a2e;
}

/* ================= BASE ================= */

body{
 margin:0;
 background:linear-gradient(180deg,var(--bg1),var(--bg2));
 color:#eee;
 font-family:"Segoe UI",Arial;
 overflow-x:hidden;
}

header{
 background:linear-gradient(90deg,#0c1020,#1a2040);
 padding:18px;
 text-align:center;
 color:var(--gold);
 font-size:26px;
 font-weight:700;
 box-shadow:0 3px 12px black;
}

.lang button{
 margin:3px;
}

.container{
 max-width:1850px;
 margin:auto;
 padding:25px;
}

/* ================= CARDS ================= */

.card{
 background:linear-gradient(180deg,#141a33,#12172a);
 padding:22px;
 border-radius:16px;
 margin-bottom:24px;
 box-shadow:0 0 20px rgba(0,0,0,.5);
 border:1px solid #1f2750;

 opacity:0;
 transform:translateY(40px);
 transition:all .7s ease;
}

.card.show{
 opacity:1;
 transform:translateY(0);
}

/* ================= BUTTONS ================= */

button{
 background:linear-gradient(90deg,var(--gold),#ffd966);
 border:none;
 padding:8px 16px;
 border-radius:10px;
 font-weight:700;
 cursor:pointer;
 transition:all .25s ease;
}

button:hover{
 transform:translateY(-2px) scale(1.05);
 box-shadow:0 8px 18px rgba(0,0,0,.4);
}

button:active{
 transform:scale(.95);
}

/* ================= INPUT ================= */

input,select{
 width:100%;
 padding:8px;
 margin:4px 0;
 background:#080c18;
 color:white;
 border:1px solid #2a3366;
 border-radius:8px;
}

/* ================= GRID ================= */

.grid{
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(230px,1fr));
 gap:14px;
}

.kpi{
 background:#070b18;
 border:1px solid #2a3366;
 padding:15px;
 border-radius:12px;
 text-align:center;
 transition:.3s;
}

.kpi:hover{
 background:#0c1230;
 transform:scale(1.05);
}

/* ================= UTILITY ================= */

.flex{
 display:flex;
 justify-content:space-between;
 align-items:center;
 gap:10px;
}

.small{
 font-size:13px;
 color:#b8c0ff;
 line-height:1.6;
 margin-top:8px;
}

canvas{
 margin-top:12px;
 animation:fade .6s ease;
}

@keyframes fade{
 from{opacity:0;transform:translateY(10px)}
 to{opacity:1}
}

/* ================= EXPORT ================= */

.export-btn{
 margin-top:10px;
 background:linear-gradient(90deg,#4f9cff,#3ad29f);
 color:#000;
}

/* ================= SCROLL BAR ================= */

::-webkit-scrollbar{
 width:8px;
}

::-webkit-scrollbar-thumb{
 background:var(--gold);
 border-radius:10px;
}

</style>
</head>

<body>

<header>

<span data-t="title">AntiquaVision â€” Business Intelligence</span>

<div class="lang">
<button onclick="setLang('it')">ğŸ‡®ğŸ‡¹</button>
<button onclick="setLang('en')">ğŸ‡¬ğŸ‡§</button>
<button onclick="setLang('de')">ğŸ‡©ğŸ‡ª</button>
<button onclick="setLang('fr')">ğŸ‡«ğŸ‡·</button>
</div>

</header>

<div class="container">

<!-- IMPORT -->
<div class="card section">

<h3 data-t="import">ğŸ“‚ Importa File</h3>

<input type="file" id="file">

<button onclick="loadFile()" data-t="analyze">Analizza</button>

<div id="res"></div>

</div>

<!-- KPI -->
<div class="card section">

<h3 data-t="dashboard">ğŸ“Š Dashboard</h3>

<div class="grid" id="kpi"></div>

<div class="small" data-t="kpiHelp"></div>

</div>

<!-- GUIDE -->
<div class="card section">

<h3 data-t="guideTitle">ğŸ“˜ Guida</h3>

<div class="small" data-t="guideText"></div>

</div>

<!-- CHART TEMPLATE -->

<div id="charts"></div>

</div>

<script>

/* ================= LANGUAGE ================= */

let lang="it";

const TXT={

it:{
 title:"AntiquaVision â€” Business Intelligence",
 import:"ğŸ“‚ Importa File",
 analyze:"Analizza",
 dashboard:"ğŸ“Š Dashboard",
 kpiHelp:"Ricavi â€¢ Costi â€¢ Profitto â€¢ ROI",
 guideTitle:"ğŸ“˜ Guida",
 guideText:"ROI >30% = Ottimo â€¢ <15% = Rischio",
 rev:"ğŸ“ˆ Ricavi",
 profit:"ğŸ›ï¸ Profitto",
 roi:"ğŸ“Š ROI",
 margin:"ğŸ’¸ Margine",
 volume:"ğŸ“¦ Volume"
},

en:{
 title:"AntiquaVision â€” Business Intelligence",
 import:"ğŸ“‚ Import File",
 analyze:"Analyze",
 dashboard:"ğŸ“Š Dashboard",
 kpiHelp:"Revenue â€¢ Costs â€¢ Profit â€¢ ROI",
 guideTitle:"ğŸ“˜ Guide",
 guideText:"ROI >30% = Great",
 rev:"ğŸ“ˆ Revenue",
 profit:"ğŸ›ï¸ Profit",
 roi:"ğŸ“Š ROI",
 margin:"ğŸ’¸ Margin",
 volume:"ğŸ“¦ Volume"
}

};

function setLang(l){
 lang=l;
 document.querySelectorAll("[data-t]").forEach(el=>{
  let k=el.dataset.t;
  if(TXT[l][k]) el.innerText=TXT[l][k];
 });
}

/* ================= CORE ================= */

let all=[],filtered=[];
let charts={};

const COLORS=["#4f9cff","#3ad29f","#ff6b6b","#9b7bff","#ffd966","#ff9f43"];

function num(v){
 return Number(String(v||"")
 .replace("â‚¬","")
 .replace(",",".")
 .replace(/\s/g,""))||0;
}

/* ================= FILE ================= */

function loadFile(){

 let f=file.files[0];
 if(!f)return;

 let ext=f.name.split(".").pop();

 if(ext==="xlsx"){

  let r=new FileReader();

  r.onload=e=>{
   let wb=XLSX.read(new Uint8Array(e.target.result),{type:"array"});
   prepare(XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]));
  };

  r.readAsArrayBuffer(f);

 }else{

  Papa.parse(f,{
   header:true,
   skipEmptyLines:true,
   complete:r=>prepare(r.data)
  });
 }
}

/* ================= PREPARE ================= */

function prepare(rows){

 all=rows.map(r=>({

  epoca:r["epoca"]||"",
  tipo:r["TIPOLOGIA"]||"",
  canale:r["luogo di vendita"]||"",
  mese:r["MeseNorm"]||"",
  prezzo:num(r["prezzo di vendita"]),
  costo:num(r["acquisto"]),
  profitto:num(r["profitto"])

 }));

 filtered=[...all];

 res.innerHTML="âœ”ï¸ "+all.length+" record caricati";

 render();
}

/* ================= TOOLS ================= */

function group(arr,k,v){

 let o={};

 arr.forEach(x=>{
  if(!x[k])return;
  o[x[k]]=(o[x[k]]||0)+x[v];
 });

 return o;
}

/* ================= CHART ================= */

function draw(id,label,obj,type){

 if(charts[id])charts[id].destroy();

 charts[id]=new Chart(document.getElementById(id),{

  type,

  data:{
   labels:Object.keys(obj),
   datasets:[{
    label,
    data:Object.values(obj),
    backgroundColor:Object.keys(obj)
    .map((_,i)=>COLORS[i%COLORS.length])
   }]
  },

  options:{
   responsive:true,
   animation:{
    duration:1200,
    easing:"easeOutQuart"
   },
   plugins:{
    tooltip:{
     backgroundColor:"#111",
     padding:12,
     cornerRadius:8,
     displayColors:false
    }
   }
  }

 });
}

/* ================= EXPORT ================= */

function exportPNG(id){

 let c=document.getElementById(id);

 let a=document.createElement("a");
 a.download=id+".png";
 a.href=c.toDataURL();
 a.click();
}

/* ================= RENDER ================= */

function render(){

 /* KPI */

 let r=0,c=0,p=0;

 filtered.forEach(x=>{
  r+=x.prezzo;
  c+=x.costo;
  p+=x.profitto;
 });

 let roi=(p/c*100)||0;

 kpi.innerHTML=`

 <div class="kpi">${r.toFixed(0)}â‚¬<br>Ricavi</div>
 <div class="kpi">${c.toFixed(0)}â‚¬<br>Costi</div>
 <div class="kpi">${p.toFixed(0)}â‚¬<br>Profitto</div>
 <div class="kpi">${roi.toFixed(1)}%<br>ROI</div>
 <div class="kpi">${filtered.length}<br>Vendite</div>

 `;

 /* CHARTS */

 chartsBox.innerHTML="";

 let defs=[

  ["c1","canale","prezzo","Ricavi"],
  ["c2","epoca","profitto","Profitto"],
  ["c3","epoca","profitto","ROI"],
  ["c4","tipo","profitto","Margine"],
  ["c5","canale","profitto","Volume"]

 ];

 charts.innerHTML="";

 defs.forEach((d,i)=>{

  let id=d[0];

  charts.innerHTML+=`

  <div class="card section">

   <div class="flex">

    <h3>${d[3]}</h3>

    <select id="t${i}" onchange="render()">
     <option>bar</option>
     <option>line</option>
     <option>doughnut</option>
    </select>

   </div>

   <canvas id="${id}"></canvas>

   <button class="export-btn" onclick="exportPNG('${id}')">
    â¬‡ï¸ Esporta PNG
   </button>

  </div>
  `;

  let o=group(filtered,d[1],d[2]);

  draw(id,d[3],o,document.getElementById("t"+i).value);

 });

 observe();

}

/* ================= ANIMATIONS ================= */

const obs=new IntersectionObserver(e=>{

 e.forEach(x=>{
  if(x.isIntersecting) x.target.classList.add("show");
 });

});

function observe(){

 document.querySelectorAll(".section").forEach(s=>{
  obs.observe(s);
 });

}

observe();

</script>

</body>
</html>
