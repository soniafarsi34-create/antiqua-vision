<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>AntiquaVision Smart Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>

body{
 margin:0;
 background:#0b0e14;
 color:#eee;
 font-family:Arial;
}

header{
 background:#111;
 padding:15px;
 text-align:center;
 color:gold;
 font-size:24px;
 font-weight:bold;
}

.lang{
 margin-top:6px;
}

.container{
 max-width:1700px;
 margin:auto;
 padding:20px;
}

.card{
 background:#151922;
 padding:20px;
 border-radius:12px;
 margin-bottom:20px;
}

button{
 background:gold;
 border:none;
 padding:7px 14px;
 border-radius:6px;
 font-weight:bold;
 cursor:pointer;
}

input,select{
 width:100%;
 padding:7px;
 margin:4px 0;
 background:#0b0e14;
 color:white;
 border:1px solid #333;
}

.inline{width:auto}

.grid{
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
 gap:12px;
}

.kpi{
 background:#0b0e14;
 border:1px solid #333;
 padding:12px;
 border-radius:8px;
 text-align:center;
}

.flex{
 display:flex;
 justify-content:space-between;
 align-items:center;
}

.small{
 font-size:13px;
 color:#aaa;
 line-height:1.5;
}

hr{border:1px solid #222;margin:15px 0}

</style>
</head>

<body>

<header>
<span data-t="title">AntiquaVision â€” Smart Dashboard</span>

<div class="lang">
<button onclick="setLang('it')">ğŸ‡®ğŸ‡¹</button>
<button onclick="setLang('en')">ğŸ‡¬ğŸ‡§</button>
<button onclick="setLang('de')">ğŸ‡©ğŸ‡ª</button>
<button onclick="setLang('fr')">ğŸ‡«ğŸ‡·</button>
</div>
</header>

<div class="container">

<!-- IMPORT -->

<div class="card">

<h3 data-t="import">ğŸ“‚ Importa File</h3>

<input type="file" id="file">

<button onclick="loadFile()" data-t="analyze">Analizza</button>

<div id="res"></div>

</div>

<!-- KPI -->

<div class="card">

<h3 data-t="dashboard">ğŸ“Š Dashboard</h3>

<div class="grid" id="kpi"></div>

<div class="small" data-t="kpi_help">

Ricavi = Incassi totali â€¢ Costi = Spese â€¢ Profitto = Guadagno â€¢ ROI = Rendimento â€¢ Vendite = Numero oggetti

</div>

</div>

<!-- GUIDE -->

<div class="card">

<h3>ğŸ“˜ Guida Lettura Dati</h3>

<div class="small" data-t="guide">

ROI >30% = Ottimo â€¢ 15â€“30% = Medio â€¢ <15% = Rischio  
Premium >30% fatturato = Punta su pezzi importanti  
Volume alto â‰  Profitto alto  

</div>

</div>

<!-- CHARTS -->

<div class="card">
<div class="flex">
<h3 data-t="revChannel">ğŸ“ˆ Ricavi per Canale</h3>
<select id="t1" onchange="drawCharts()">
<option>bar</option><option>line</option><option>pie</option><option>doughnut</option>
</select>
</div>
<canvas id="c1"></canvas>
</div>

<div class="card">
<div class="flex">
<h3 data-t="profitEra">ğŸ›ï¸ Profitto per Epoca</h3>
<select id="t2" onchange="drawCharts()">
<option>bar</option><option>line</option><option>pie</option><option>doughnut</option>
</select>
</div>
<canvas id="c2"></canvas>
</div>

<div class="card">
<div class="flex">
<h3 data-t="roiEra">ğŸ“Š ROI per Epoca</h3>
<select id="t3" onchange="drawCharts()">
<option>bar</option><option>line</option>
</select>
</div>
<canvas id="c3"></canvas>
</div>

<div class="card">
<div class="flex">
<h3 data-t="roiType">ğŸ“Š ROI per Categoria</h3>
<select id="t4" onchange="drawCharts()">
<option>bar</option><option>line</option>
</select>
</div>
<canvas id="c4"></canvas>
</div>

<div class="card">
<div class="flex">
<h3 data-t="costPrice">ğŸ’¸ Costo vs Prezzo</h3>
<select id="t5" onchange="drawCharts()">
<option>bar</option><option>line</option>
</select>
</div>
<canvas id="c5"></canvas>
</div>

<div class="card">
<div class="flex">
<h3 data-t="volumeProfit">ğŸ“¦ Volume vs Profitto</h3>
<select id="t6" onchange="drawCharts()">
<option>bar</option><option>line</option>
</select>
</div>
<canvas id="c6"></canvas>
</div>

<!-- PREMIUM -->

<div class="card">

<h3 data-t="premium">ğŸ’ Impatto Vendite Premium (>1000â‚¬)</h3>

<div id="premiumImpact"></div>

<div class="small" data-t="premium_help">

Se poche vendite generano molto fatturato â†’ strategia premium vincente.

</div>

<canvas id="c7"></canvas>

</div>

<!-- AI -->

<div class="card">

<h3 data-t="ai">ğŸ¤– Consulente AI</h3>

<div id="ai"></div>

</div>

</div>

<script>

/* ================= LANG ================= */

let lang="it";

const TXT={

 it:{
  title:"AntiquaVision â€” Smart Dashboard",
  import:"ğŸ“‚ Importa File",
  analyze:"Analizza",
  dashboard:"ğŸ“Š Dashboard",
  revChannel:"Ricavi per Canale",
  profitEra:"Profitto per Epoca",
  roiEra:"ROI per Epoca",
  roiType:"ROI per Categoria",
  costPrice:"Costo vs Prezzo",
  volumeProfit:"Volume vs Profitto",
  premium:"Impatto Vendite Premium",
  ai:"ğŸ¤– Consulente AI",
  guide:"ROI >30% = Ottimo â€¢ 15â€“30% = Medio â€¢ <15% = Rischio",
  kpi_help:"Ricavi = Incassi â€¢ Costi = Spese â€¢ Profitto = Guadagno â€¢ ROI = Rendimento",
  premium_help:"Se poche vendite portano molto fatturato â†’ punta su premium"
 },

 en:{
  title:"AntiquaVision â€” Smart Dashboard",
  import:"ğŸ“‚ Import File",
  analyze:"Analyze",
  dashboard:"ğŸ“Š Dashboard",
  revChannel:"Revenue by Channel",
  profitEra:"Profit by Era",
  roiEra:"ROI by Era",
  roiType:"ROI by Category",
  costPrice:"Cost vs Price",
  volumeProfit:"Volume vs Profit",
  premium:"Premium Impact",
  ai:"ğŸ¤– AI Advisor",
  guide:"ROI >30% = Great â€¢ 15â€“30% = Medium â€¢ <15% = Risk",
  kpi_help:"Revenue = Income â€¢ Cost = Expenses â€¢ Profit = Earnings â€¢ ROI = Return",
  premium_help:"Few sales = big revenue â†’ premium strategy"
 },

 de:{
  title:"AntiquaVision â€” Dashboard",
  import:"ğŸ“‚ Datei Importieren",
  analyze:"Analysieren",
  dashboard:"ğŸ“Š Ãœbersicht",
  revChannel:"Umsatz nach Kanal",
  profitEra:"Gewinn nach Epoche",
  roiEra:"ROI nach Epoche",
  roiType:"ROI nach Kategorie",
  costPrice:"Kosten vs Preis",
  volumeProfit:"Volumen vs Gewinn",
  premium:"Premium VerkÃ¤ufe",
  ai:"ğŸ¤– KI Berater",
  guide:"ROI >30% = Sehr gut â€¢ <15% = Risiko",
  kpi_help:"Umsatz â€¢ Kosten â€¢ Gewinn â€¢ ROI",
  premium_help:"Wenige VerkÃ¤ufe = hoher Umsatz"
 },

 fr:{
  title:"AntiquaVision â€” Tableau",
  import:"ğŸ“‚ Importer Fichier",
  analyze:"Analyser",
  dashboard:"ğŸ“Š Tableau",
  revChannel:"Revenus par Canal",
  profitEra:"Profit par Ã‰poque",
  roiEra:"ROI par Ã‰poque",
  roiType:"ROI par CatÃ©gorie",
  costPrice:"CoÃ»t vs Prix",
  volumeProfit:"Volume vs Profit",
  premium:"Ventes Premium",
  ai:"ğŸ¤– Conseiller IA",
  guide:"ROI >30% = Excellent â€¢ <15% = Risque",
  kpi_help:"Revenus â€¢ CoÃ»ts â€¢ Profit â€¢ ROI",
  premium_help:"Peu de ventes = gros chiffre"
 }

};

function setLang(l){

 lang=l;

 document.querySelectorAll("[data-t]").forEach(el=>{

  let k=el.getAttribute("data-t");

  if(TXT[l][k]) el.innerText=TXT[l][k];
 });
}

/* ================= DATA ================= */

let all=[],filtered=[];
let charts={};

/* ================= LOAD ================= */

function loadFile(){

 let f=file.files[0];
 if(!f) return alert("Carica file");

 let ext=f.name.split(".").pop().toLowerCase();

 if(ext==="xlsx"){

  let r=new FileReader();

  r.onload=e=>{
   let wb=XLSX.read(new Uint8Array(e.target.result),{type:"array"});
   prepare(XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]));
  };

  r.readAsArrayBuffer(f);

 }else{

  Papa.parse(f,{
   header:true,
   skipEmptyLines:true,
   complete:r=>prepare(r.data)
  });
 }
}

/* ================= PREPARE ================= */

function prepare(rows){

 all=rows.map(r=>({

  epoca:r["epoca"]||"",
  tipo:r["TIPOLOGIA"]||"",
  paese:r["Nazionalita acquirente"]||"",
  canale:r["luogo di vendita"]||"",

  prezzo:num(r["prezzo di vendita"]),
  costo:num(r["acquisto"]),
  profitto:num(r["profitto"])

 }));

 filtered=[...all];

 res.innerHTML="âœ”ï¸ "+all.length+" record";

 render();
}

/* ================= NUM ================= */

function num(v){

 return Number(String(v||"")
 .replace("â‚¬","")
 .replace("%","")
 .replace(",",".")
 .replace(/\s/g,""))||0;
}

/* ================= GROUP ================= */

function group(arr,k,v){

 let o={};

 arr.forEach(x=>{
  if(!x[k])return;
  o[x[k]]=(o[x[k]]||0)+x[v];
 });

 return o;
}

/* ================= RENDER ================= */

function render(){

 if(!filtered.length)return;

 renderKPI();
 drawCharts();
 renderAI();
 renderPremium();
}

/* ================= KPI ================= */

function renderKPI(){

 let r=0,c=0,p=0;

 filtered.forEach(x=>{
  r+=x.prezzo;
  c+=x.costo;
  p+=x.profitto;
 });

 let roi=(p/c*100)||0;

 kpi.innerHTML=`

 <div class="kpi"><b>${r.toFixed(0)}â‚¬</b><br>Ricavi</div>
 <div class="kpi"><b>${c.toFixed(0)}â‚¬</b><br>Costi</div>
 <div class="kpi"><b>${p.toFixed(0)}â‚¬</b><br>Profitto</div>
 <div class="kpi"><b>${roi.toFixed(1)}%</b><br>ROI</div>
 <div class="kpi"><b>${filtered.length}</b><br>Vendite</div>

 `;
}

/* ================= CHARTS ================= */

function drawCharts(){

 draw("c1","Revenue",group(filtered,"canale","prezzo"),t1.value);
 draw("c2","Profit",group(filtered,"epoca","profitto"),t2.value);

 draw("c3","ROI",roiBy("epoca"),t3.value);
 draw("c4","ROI",roiBy("tipo"),t4.value);

 draw("c5","Cost vs Price",costVsPrice(),t5.value);
 draw("c6","Volume vs Profit",volumeProfit(),t6.value);

 drawPremiumChart();
}

/* ================= DRAW ================= */

function draw(id,label,obj,type){

 if(charts[id])charts[id].destroy();

 charts[id]=new Chart(document.getElementById(id),{
  type,
  data:{
   labels:Object.keys(obj),
   datasets:[{
    label,
    data:Object.values(obj),
    backgroundColor:"gold"
   }]
  }
 });
}

/* ================= ANALYTICS ================= */

function roiBy(key){

 let map={};

 filtered.forEach(x=>{

  if(!x[key])return;

  if(!map[x[key]])map[x[key]]={p:0,c:0};

  map[x[key]].p+=x.profitto;
  map[x[key]].c+=x.costo;
 });

 let r={};

 for(let k in map){
  r[k]=(map[k].p/map[k].c*100)||0;
 }

 return r;
}

function costVsPrice(){

 let r={};

 filtered.forEach(x=>{

  let k=x.tipo||"Other";

  if(!r[k])r[k]={c:0,p:0};

  r[k].c+=x.costo;
  r[k].p+=x.prezzo;
 });

 let o={};

 for(let k in r){
  o[k]=r[k].p-r[k].c;
 }

 return o;
}

function volumeProfit(){

 let r={};

 filtered.forEach(x=>{

  let k=x.canale||"Other";

  if(!r[k])r[k]={v:0,p:0};

  r[k].v++;
  r[k].p+=x.profitto;
 });

 let o={};

 for(let k in r){
  o[k]=r[k].p/r[k].v;
 }

 return o;
}

/* ================= PREMIUM ================= */

function analyzePremium(){

 let totalRev=0,total=filtered.length;
 let pCount=0,pRev=0;

 filtered.forEach(x=>{

  totalRev+=x.prezzo;

  if(x.prezzo>=1000){
   pCount++;
   pRev+=x.prezzo;
  }
 });

 return {
  total,
  totalRev,
  pCount,
  pRev,
  percCount:(pCount/total*100)||0,
  percRev:(pRev/totalRev*100)||0
 };
}

function renderPremium(){

 let p=analyzePremium();

 let strategy="";

 if(p.percRev>40)strategy="ğŸ”¥ Premium dominante";
 else if(p.percRev>25)strategy="âœ… Premium importante";
 else strategy="âš ï¸ Meglio fascia media";

 premiumImpact.innerHTML=`

 ğŸ“¦ Vendite totali: <b>${p.total}</b><br>
 ğŸ’° Fatturato: <b>${p.totalRev.toFixed(0)}â‚¬</b><br><br>

 ğŸ’ >1000â‚¬: <b>${p.pCount}</b> (${p.percCount.toFixed(1)}%)<br>
 ğŸ’ Incasso: <b>${p.pRev.toFixed(0)}â‚¬</b> (${p.percRev.toFixed(1)}%)<br><br>

 ğŸ“Œ Strategia: <b>${strategy}</b>

 `;
}

function drawPremiumChart(){

 let p=analyzePremium();

 let o={
  "Premium >1000â‚¬":p.pRev,
  "Altri":p.totalRev-p.pRev
 };

 draw("c7","Premium Revenue",o,"pie");
}

/* ================= AI ================= */

function renderAI(){

 let bestROI=max(roiBy("epoca"));
 let bestCat=max(roiBy("tipo"));

 ai.innerHTML=`

 ğŸ’ ROI Top: <b>${bestROI}</b><br>
 ğŸº Categoria Top: <b>${bestCat}</b><br>

 ğŸ’¡ Concentrati su questi settori.

 `;
}

/* ================= MAX ================= */

function max(o){

 let m=-1e9,k="N/A";

 for(let x in o){
  if(o[x]>m){m=o[x];k=x;}
 }

 return k;
}

</script>

</body>
</html>
